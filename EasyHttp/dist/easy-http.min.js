/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.EasyHttp=n()}(this,function(){"use strict";var h={i:function(t,n){console.log(t+":",n)},d:function(t,n){console.debug(t+":",n)},w:function(t,n){console.warn(t+":",n)},e:function(t,n){console.error(t+":",n)}},t=function(){function r(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),t}}();var o=/(?:\[([^{[]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,n=[Symbol("createSrc"),Symbol("getRequestItem"),Symbol("createRequestItem"),Symbol("createHandler"),Symbol("analysis"),Symbol("baseUrl"),Symbol("src"),Symbol("requests"),Symbol("dictateMap"),Symbol("actionMap"),Symbol("serializater"),Symbol("processors"),Symbol("errorHandler"),Symbol("logConfig")],a=n[0],c=n[1],e=n[2],u=n[3],y=n[4],d=n[5],s=n[6],r=n[7],f=n[8],p=n[9],v=n[10],i=n[11],b=n[12],m=n[13];function g(t,n){return null==t?t===n:t.constructor===n||t instanceof n}function S(t){return g(t,Object)&&(t=JSON.stringify(t)),t}function w(t){h.e("EasyHttp-Error",t&&t.toString()||t)}var l=function(){function l(t,e){var r=this;if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,l),this[d]=t,e){this[s]={};var n=function(n){r[s][n]=r[a](e[n]),Object.defineProperty(r,n,{get:function(){var t=this[c](n);return t&&t.handler}})};for(var i in e)n(i)}}return t(l,[{key:a,value:function(t){var n=void 0;if(t&&g(t,Object)){n={action:t.action||t.a,urlFormat:t.urlFormat||t.u};var e=t.dictate||t.d;if(e)e.split(":").forEach(function(t){t&&(n.dictate||(n.dictate=new Array),n.dictate.push(t))})}else n={urlFormat:t};return n}},{key:c,value:function(t){return this[r]||(this[r]={}),t in this[s]&&!(t in this[r])&&(this[r][t]=this[e](this[s][t])),this[r]&&this[r][t]}},{key:e,value:function(t){for(var e={},r=void 0,n=function(){var n={match:r[0],prefix:r[1],key:r[2],suffix:r[4]};r[3]&&r[3].split(":").forEach(function(t){t&&(n.dictate||(n.dictate=new Array),n.dictate.push(t))});e.matchsArray||(e.matchsArray=new Array),e.matchsArray.push(n)};null!=(r=o.exec(t.urlFormat));)n();var i=this;return Object.defineProperty(e,"handler",{get:function(){return i[u](t,e)}}),e}},{key:u,value:function(u,e){var s=this,f=!1,t=function t(c){return new Promise(function(n,e){var t=this.getUrl(c);h.i("EasyHttp-Url",t);var r=(u.action||"").toLowerCase(),i=this[p]&&this[p][r]||l[p]&&l[p][r];if(i)if(g(i,Function))i(function(t){return h.i("EasyHttp-Response",t&&null!=t.data&&t.data||t),n(t)},function(t){return f?e(t):(s[b]||l[b]||w)(t)},t);else{var o=r?"the action:'"+r+"' is not Function":"default action is not Function";h.w(o)}else{var a=r?"not found the action:'"+r+"'":"not found default action";h.w(a)}}.bind(t))},n=function(t){var n=s[y](u,e.matchsArray,t);return s[d]+n};Object.defineProperty(t,"getUrl",{get:function(){return n}});var r=function(t){return this.header=t,this}.bind(t);Object.defineProperty(t,"header",{get:function(){return r}});var i=function(){return f=!0,arguments&&0<arguments.length?this.apply(void 0,arguments):this}.bind(t);return Object.defineProperty(t,"c",{get:function(){return i}}),t}},{key:y,value:function(a,t,c){var u=this,s=a.urlFormat;return t&&(c||(c={}),t.forEach(function(t){var n=t.key,e=c[n],r=u[v]||l[v]||S;e=r(e);var i=t.dictate||a.dictate;if(i)i.forEach(function(t){var n=u[f]&&u[f][t]||l[f]&&l[f][t];n&&(e=n(e))});else{var o=u[o]||l[o];o&&o.forEach(function(t){e=t(e)})}e=e?(t.prefix||"")+e+(t.suffix||""):"",s=s.replace(t.match,e)})),s||(s=""),s}}],[{key:"logConfig",value:function(t){this[m]=t}}]),l}(),E={bindAction:function(t,n){t||(t=""),this[p]||(this[p]={}),n&&(this[p][t.toLowerCase()]=n)},bindDictate:function(t,n){this[f]||(this[f]={}),t&&n&&(this[f][t.toLowerCase()]=n)},setSerializater:function(t){this[v]=t},setErrorHandler:function(t){this[b]=t},addProcessor:function(){for(var t,n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];this[i]||(this[i]=new Array),e&&(t=this[i]).push.apply(t,e)},use:function(t){t&&t.install&&g(t.install,Function)&&t.install(this)}},j=function(t){Object.defineProperty(l,t,{get:function(){return function(){E[t].apply(this,arguments)}.bind(this)}}),Object.defineProperty(l.prototype,t,{get:function(){return function(){E[t].apply(this,arguments)}.bind(this)}})};for(var O in E)j(O);return l});