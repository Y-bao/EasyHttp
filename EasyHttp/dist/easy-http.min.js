/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.EasyHttp=r()}(this,function(){"use strict";function o(t){if(Array.isArray(t)){for(var r=0,n=Array(t.length);r<t.length;r++)n[r]=t[r];return n}return Array.from(t)}var l={i:function(t){for(var r,n=arguments.length,e=Array(1<n?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];(r=console).log.apply(r,[t+":"].concat(o(e)))},d:function(t){for(var r,n=arguments.length,e=Array(1<n?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];(r=console).debug.apply(r,[t+":"].concat(o(e)))},w:function(t){for(var r,n=arguments.length,e=Array(1<n?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];(r=console).warn.apply(r,[t+":"].concat(o(e)))},e:function(t){for(var r,n=arguments.length,e=Array(1<n?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];(r=console).error.apply(r,[t+":"].concat(o(e)))}},t=function(){function e(t,r){for(var n=0;n<r.length;n++){var e=r[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=/(?:\[([^[{]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,r=[Symbol("createSrc"),Symbol("getRequestItem"),Symbol("createRequestItem"),Symbol("createHandler"),Symbol("analysis"),Symbol("baseUrl"),Symbol("src"),Symbol("requests"),Symbol("dictateMap"),Symbol("actionMap"),Symbol("serializater"),Symbol("processors"),Symbol("errorHandler"),Symbol("logConfig"),Symbol("isHold")],c=r[0],u=r[1],n=r[2],s=r[3],e=r[4],y=r[5],f=r[6],i=r[7],p=r[8],d=r[9],v=r[10],m=r[11],b=r[12],g=r[13],S=r[14];function w(t,r){return null==t?t===r:t.constructor===r||t instanceof r}function H(t){return w(t,Object)&&(t=JSON.stringify(t)),t}function A(t){l.e("EasyHttp-ResponseError",t&&t.toString()||t)}var E="*:hold-bl:*",O="*:hold-br:*",j="*:hold-ml:*",F="*:hold-mr:*";var h=function(){function h(t,n){var e=this;if(function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,h),this[y]=t||"",n){this[f]={};var r=function(r){e[f][r]=e[c](n[r]),Object.defineProperty(e,r,{get:function(){var t=this[u](r);return t&&t.handler}})};for(var i in n)r(i)}}return t(h,[{key:c,value:function(t){var r=void 0;if(t&&w(t,Object)){r={action:t.action||t.a,urlFormat:t.urlFormat||t.u,isHold:t.hold||t.h};var n=t.dictate||t.d;if(n)n.split(":").forEach(function(t){t&&(r.dictate||(r.dictate=new Array),r.dictate.push(t))})}else r={urlFormat:t};return r}},{key:u,value:function(t){return this[i]||(this[i]={}),t in this[f]&&!(t in this[i])&&(this[i][t]=this[n](this[f][t])),this[i]&&this[i][t]}},{key:n,value:function(t){var r,n={},e=void 0;(t.isHold||this[S]||h[S])&&(t.urlFormat=(r=t.urlFormat)?r.replace("\\{",E).replace("\\}",O).replace("\\[",j).replace("\\]",F):r);for(var i=function(){var r={match:e[0],prefix:e[1],key:e[2],suffix:e[4]};e[3]&&e[3].split(":").forEach(function(t){t&&(r.dictate||(r.dictate=new Array),r.dictate.push(t))});n.matchsMap||(n.matchsMap={}),n.matchsMap[r.key]=r};null!=(e=a.exec(t.urlFormat));)i();var o=this;return Object.defineProperty(n,"handler",{get:function(){return o[s](t,n)}}),n}},{key:s,value:function(u,r){var s=this,f=!1,n=function t(c){return new Promise(function(r,n){var t=this.getUrl(c);l.i("EasyHttp-Url",t);var e=(u.action||"get").toLowerCase(),i=s[d]&&s[d][e]||h[d]&&h[d][e];if(i)if(w(i,Function))i(function(t){return l.i("\nEasyHttp-Response",t&&null!=t.data&&t.data||t),r(t)},function(t){return f?n(t):(s[b]||h[b]||A)(t)},t);else{var o=e?"the action:'"+e+"' is not Function":"default action is not Function";l.w("EasyHttp",o)}else{var a=e?"not found the action:'"+e+"'":"not found default action";l.w("EasyHttp",a)}}.bind(t))};return Object.defineProperty(n,"getUrl",{get:function(){return function(t){return s[e](u,r.matchsMap,t)}}}),Object.defineProperty(n,"header",{get:function(){return function(t){return n.header=t,n}}}),Object.defineProperty(n,"catch",{get:function(){return function(t){return f=t,n}}}),n}},{key:e,value:function(a,c,u){var s=this,f=a.urlFormat,l=void 0;if(u||(u={}),c||(c={}),c)for(var t in c)if(!(t in u)){var r=c[t];f=f.replace(r.match,"")}var n,e=function(t){var r=c[t],n=u[t]||"",e=s[v]||h[v]||H;n=e(n);var i=r&&r.dictate||a.dictate;if(i)i.forEach(function(t){var r=s[p]&&s[p][t]||h[p]&&h[p][t];r&&(n=r(n))});else{var o=s[m]||h[m];o&&o.forEach(function(t){n=t(n)})}r?(n=n?(r.prefix||"")+n+(r.suffix||""):"",f=f.replace(r.match,n)):(n||(n=""),l||(l=""),l+=(l?"&":"")+t+"="+n)};for(var i in u)e(i);f=f?a.isHold||this[S]||h[S]?(n=f)?n.replace(E,"{").replace(O,"}").replace(j,"[").replace(F,"]"):n:f:"";var o=this[y]+f;return l&&(o+=(o.indexOf("?")<0?"?":"&")+l),o}}],[{key:"logConfig",value:function(t){this[g]=t}}]),h}(),P={bindAction:function(t,r){if(t||(t=""),this[d]||(this[d]={}),r)return this[d][t.toLowerCase()]=r,this},bindDictate:function(t,r){if(this[p]||(this[p]={}),t&&r)return this[p][t.toLowerCase()]=r,this},setSerializater:function(t){return this[v]=t,this},setErrorHandler:function(t){return this[b]=t,this},setIsHold:function(t){return this[S]=t,this},addProcessor:function(){for(var t,r=arguments.length,n=Array(r),e=0;e<r;e++)n[e]=arguments[e];if(this[m]||(this[m]=new Array),n)return(t=this[m]).push.apply(t,n),this},use:function(t){return t&&t.install&&w(t.install,Function)&&t.install(this),this}},k=function(t){Object.defineProperty(h,t,{get:function(){return function(){return P[t].apply(this,arguments)}.bind(this)}}),Object.defineProperty(h.prototype,t,{get:function(){return function(){return P[t].apply(this,arguments)}.bind(this)}})};for(var x in P)k(x);return h});