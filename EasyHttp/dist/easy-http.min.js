/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("babel-runtime/core-js/object/get-prototype-of"),require("babel-runtime/helpers/possibleConstructorReturn"),require("babel-runtime/helpers/inherits"),require("babel-runtime/core-js/json/stringify"),require("babel-runtime/helpers/toConsumableArray"),require("babel-runtime/core-js/promise"),require("babel-runtime/core-js/object/define-property"),require("babel-runtime/core-js/symbol")):"function"==typeof define&&define.amd?define(["babel-runtime/helpers/classCallCheck","babel-runtime/helpers/createClass","babel-runtime/core-js/object/get-prototype-of","babel-runtime/helpers/possibleConstructorReturn","babel-runtime/helpers/inherits","babel-runtime/core-js/json/stringify","babel-runtime/helpers/toConsumableArray","babel-runtime/core-js/promise","babel-runtime/core-js/object/define-property","babel-runtime/core-js/symbol"],e):t.EasyHttp=e(t._classCallCheck,t._createClass,t._Object$getPrototypeOf,t._possibleConstructorReturn,t._inherits,t._JSON$stringify,t._toConsumableArray,t._Promise,t._Object$defineProperty,t._Symbol)}(this,function(a,s,o,u,e,r,l,i,c,t){"use strict";function h(t,e){return null==t?t===e:t.constructor===e||t instanceof e}a=a&&a.hasOwnProperty("default")?a.default:a,s=s&&s.hasOwnProperty("default")?s.default:s,o=o&&o.hasOwnProperty("default")?o.default:o,u=u&&u.hasOwnProperty("default")?u.default:u,e=e&&e.hasOwnProperty("default")?e.default:e,r=r&&r.hasOwnProperty("default")?r.default:r,l=l&&l.hasOwnProperty("default")?l.default:l,i=i&&i.hasOwnProperty("default")?i.default:i,c=c&&c.hasOwnProperty("default")?c.default:c,t=t&&t.hasOwnProperty("default")?t.default:t;var n=function(){function t(){a(this,t)}return s(t,[{key:"setBaseUrl",value:function(t){return this.baseUrl=t||"",this}},{key:"bindAction",value:function(t,e){return t&&e&&(this.am||(this.am={}),this.am[t.toLowerCase()]=e),this}},{key:"bindDictate",value:function(t,e){return t&&e&&(this.dm||(this.dm={}),this.dm[t.toLowerCase()]=e),this}},{key:"setSerializater",value:function(t){return this.sz=t,this}},{key:"setErrorHandler",value:function(t){return this.eh=t,this}},{key:"setEscape",value:function(t){return this.esc=t,this}},{key:"addProcessor",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var n;e&&(this.pcs||(this.pcs=new Array),(n=this.pcs).push.apply(n,e));return this}},{key:"use",value:function(t){return t&&t.install&&h(t.install,Function)&&t.install(this),this}}]),t}(),f=new n,p=function(){function e(t){a(this,e),this.outConf=t}return s(e,[{key:"actionMap",value:function(t){return this.outConf.am&&this.outConf.am[t]||f.am&&f.am[t]}},{key:"dictateMap",value:function(t){return this.outConf.dm&&this.outConf.dm[t]||f.dm&&f.dm[t]}},{key:"escape",set:function(t){t&&(this.esc=t)},get:function(){return null!=this.esc?this.esc:null!=this.outConf.esc?this.outConf.esc:null!=f.esc&&f.esc}},{key:"baseUrl",get:function(){return this.outConf.baseUrl||f.baseUrl}},{key:"serializater",get:function(){return this.outConf.sz||f.sz}},{key:"errorHandler",get:function(){return this.outConf.eh||f.eh}},{key:"processors",get:function(){return this.outConf.pcs||f.pcs}}]),e}(),d=/(?:\[([^[{]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,m="*:hold-bl:*",b="*:hold-br:*",y="*:hold-ml:*",v="*:hold-mr:*";function g(t){return h(t,Object)&&(t=r(t)),t}var _=function(t){function i(t,e){a(this,i);var r=u(this,(i.__proto__||o(i)).call(this,t));if(e)if(h(e,Object)){(e.action||e.a)&&(r._action=e.action||e.a),(e.urlFormat||e.u)&&(r._urlFormat=e.urlFormat||e.u),(e.escape||e.esc)&&(r.escape=e.escape||e.esc);var n=e.dictate||e.d;if(n)n.split(":").forEach(function(t){t&&(r.dictate||(r.dictate=new Array),r.dictate.push(t))})}else r._urlFormat=e;return r}return e(i,p),s(i,[{key:"reSetUrlFormat",value:function(){var t;this.escape?this._urlFormatHold||(this._urlFormatHold=(t=this._urlFormat)?t.replace("\\{",m).replace("\\}",b).replace("\\[",y).replace("\\]",v):t):this._urlFormatHold&&delete this._urlFormatHold,this.makeMatchsMap()}},{key:"makeMatchsMap",value:function(){var t=this;if(!this.matchsMap||this._matchsUrl!==this.urlFormat){this.matchsMap={},this._matchsUrl=this.urlFormat;for(var r=void 0,e=function(){var e={match:r[0],prefix:r[1],key:r[2],suffix:r[4]};r[3]&&r[3].split(":").forEach(function(t){t&&(e.dictate||(e.dictate=new Array),e.dictate.push(t))});t.matchsMap[e.key]=e};null!=(r=d.exec(this._matchsUrl));)e()}return this.matchsMap}},{key:"recoverUrl",value:function(t){return this._urlFormatHold?(e=t)?e.replace(m,"{").replace(b,"}").replace(y,"[").replace(v,"]"):e:t;var e}},{key:"analysis",value:function(a){var s=this;this.reSetUrlFormat(),a||(a={});var o=void 0,u=this.urlFormat,l=this.matchsMap;if(l)for(var t in l)if(!(t in a)){var e=l[t];u=u.replace(e.match,"")}var r=function(t){var e=l[t],r=a[t]||"",n=s.serializater||g;r=n(r);var i=e&&e.dictate||s.dictate;i?i.forEach(function(t){var e=s.dictateMap(t);e&&(r=e(r))}):s.processors&&s.processors.forEach(function(t){r=t(r)}),e?(r=r?(e.prefix||"")+r+(e.suffix||""):"",u=u.replace(e.match,r)):(r||(r=""),o||(o=""),o+=(o?"&":"")+t+"="+r)};for(var n in a)r(n);u=u?this.recoverUrl(u):"";var i=this.baseUrl+u;return o&&(i+=(i.indexOf("?")<0?"?":"&")+o),i}},{key:"urlFormat",get:function(){return this._urlFormatHold||this._urlFormat}},{key:"action",get:function(){return(this._action||"get").toLowerCase()}}]),i}(),k={i:function(t){for(var e,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).log.apply(e,[t+":"].concat(l(n)))},d:function(t){for(var e,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).debug.apply(e,[t+":"].concat(l(n)))},w:function(t){for(var e,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).warn.apply(e,[t+":"].concat(l(n)))},e:function(t){for(var e,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).error.apply(e,[t+":"].concat(l(n)))}};function C(t){k.e("EasyHttp-ResponseError",t&&t.toString()||t)}var w=function(t){function n(t,e){a(this,n);var r=u(this,(n.__proto__||o(n)).call(this,t));return r.ro=e,r}return e(n,p),s(n,[{key:"createHandler",value:function(){var u=this,l=void 0,e=function t(o){return new i(function(e,r){var t=this.getUrl(o);k.i("EasyHttp-Url",t);var n=u.ro.action,i=u.actionMap(n);if(i)if(h(i,Function))i(function(t){return k.i("\nEasyHttp-Response",t&&null!=t.data&&t.data||t),e(t)},function(t){return l&&l.handleCatch?r(t):(u.errorHandler||C)(t)},t);else{var a=n?"the action:'"+n+"' is not Function":"default action is not Function";k.w("EasyHttp",a)}else{var s=n?"not found the action:'"+n+"'":"not found default action";k.w("EasyHttp",s)}}.bind(t))};return e.getUrl=function(t){return u.ro.analysis(t)},e.config=function(t){return l=t,e},e}},{key:"handler",get:function(){return this.createHandler()}}]),n}(),j=[t("requestOptions"),t("requesters"),t("configure"),t("getRequestItem")],F=j[0],O=j[1],H=j[2],U=j[3],P=function(){function r(t,e){a(this,r),this[H]=new n,this.setBaseUrl(t).addRequests(e)}return s(r,[{key:U,value:function(t){return this[O]||(this[O]={}),t in this[F]&&!(t in this[O])&&(this[O][t]=new w(this[H],this[F][t])),this[O]&&this[O][t]}}]),r}();Object.defineProperty(P.prototype,"addRequests",{configurable:!1,enumerable:!1,get:function(){return function(t){var r=this;if(t){this[F]||(this[F]={});var e=function(e){r[F][e]=new _(r[H],t[e]),c(r,e,{get:function(){var t=this[U](e);return t&&t.handler}})};for(var n in t)e(n)}return this}.bind(this)}});for(var q=["setBaseUrl","bindAction","bindDictate","setSerializater","setErrorHandler","addProcessor","setEscape","use"],E=q.length,A=function(t){var e=q[t];c(P,e,{configurable:!1,enumerable:!1,get:function(){return function(){return f[e].apply(f,arguments),this}.bind(this)}}),c(P.prototype,e,{configurable:!1,enumerable:!1,get:function(){return function(){var t;return(t=this[H])[e].apply(t,arguments),this}.bind(this)}})},M=0;M<E;M++)A(M);return P});