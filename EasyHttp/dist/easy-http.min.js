/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("babel-runtime/core-js/object/get-prototype-of"),require("babel-runtime/helpers/possibleConstructorReturn"),require("babel-runtime/helpers/inherits"),require("babel-runtime/core-js/json/stringify"),require("babel-runtime/helpers/toConsumableArray"),require("babel-runtime/core-js/promise"),require("babel-runtime/core-js/object/define-property"),require("babel-runtime/core-js/symbol")):"function"==typeof define&&define.amd?define(["babel-runtime/helpers/classCallCheck","babel-runtime/helpers/createClass","babel-runtime/core-js/object/get-prototype-of","babel-runtime/helpers/possibleConstructorReturn","babel-runtime/helpers/inherits","babel-runtime/core-js/json/stringify","babel-runtime/helpers/toConsumableArray","babel-runtime/core-js/promise","babel-runtime/core-js/object/define-property","babel-runtime/core-js/symbol"],t):e.EasyHttp=t(e._classCallCheck,e._toConsumableArray,e._Object$getPrototypeOf,e._possibleConstructorReturn,e._inherits,e._toConsumableArray,e._toConsumableArray,e._Promise,e._Object$defineProperty,e._toConsumableArray)}(this,function(i,o,s,u,t,r,c,a,l,e){"use strict";function h(e,t){return null==e?e===t:e.constructor===t||e instanceof t}i=i&&i.hasOwnProperty("default")?i.default:i,o=o&&o.hasOwnProperty("default")?o.default:o,s=s&&s.hasOwnProperty("default")?s.default:s,u=u&&u.hasOwnProperty("default")?u.default:u,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,c=c&&c.hasOwnProperty("default")?c.default:c,a=a&&a.hasOwnProperty("default")?a.default:a,l=l&&l.hasOwnProperty("default")?l.default:l,e=e&&e.hasOwnProperty("default")?e.default:e;var n=function(){function e(){i(this,e)}return o(e,[{key:"setBaseUrl",value:function(e){return this.baseUrl=e||"",this}},{key:"bindAction",value:function(e,t){return e&&t&&(this.am||(this.am={}),this.am[e.toLowerCase()]=t),this}},{key:"bindDictate",value:function(e,t){return e&&t&&(this.dm||(this.dm={}),this.dm[e.toLowerCase()]=t),this}},{key:"setSerializater",value:function(e){return this.sz=e,this}},{key:"setErrorHandler",value:function(e){return this.eh=e,this}},{key:"setEscape",value:function(e){return this.esc=e,this}},{key:"addProcessor",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;t&&(this.pcs||(this.pcs=new Array),(n=this.pcs).push.apply(n,t));return this}},{key:"use",value:function(e){return e&&e.install&&h(e.install,Function)&&e.install(this),this}}]),e}(),f=new n,p=function(){function t(e){i(this,t),this.outConf=e}return o(t,[{key:"actionMap",value:function(e){return this.outConf.am&&this.outConf.am[e]||f.am&&f.am[e]}},{key:"dictateMap",value:function(e){return this.outConf.dm&&this.outConf.dm[e]||f.dm&&f.dm[e]}},{key:"escape",set:function(e){e&&(this.esc=e)},get:function(){return null!=this.esc?this.esc:null!=this.outConf.esc?this.outConf.esc:null!=f.esc&&f.esc}},{key:"baseUrl",get:function(){return this.outConf.baseUrl||f.baseUrl}},{key:"serializater",get:function(){return this.outConf.sz||f.sz}},{key:"errorHandler",get:function(){return this.outConf.eh||f.eh}},{key:"processors",get:function(){return this.outConf.pcs||f.pcs}}]),t}(),d=/(?:\[([^[{]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,b="*:hold-bl:*",m="*:hold-br:*",y="*:hold-ml:*",v="*:hold-mr:*";function g(e){return h(e,Object)&&(e=r(e)),e}var _=function(e){function a(e,t){i(this,a);var r=u(this,(a.__proto__||s(a)).call(this,e));if(t)if(h(t,Object)){r.action=(t.action||t.a||"get").toLowerCase(),(t.urlFormat||t.u)&&(r._urlFormat=t.urlFormat||t.u),(t.escape||t.esc)&&(r.escape=t.escape||t.esc);var n=t.dictate||t.d;if(n)n.split(":").forEach(function(e){e&&(r.dictate||(r.dictate=new Array),r.dictate.push(e))})}else r._urlFormat=t;return r}return t(a,p),o(a,[{key:"reSetUrlFormat",value:function(){var e;this.escape?this._urlFormatHold||(this._urlFormatHold=(e=this._urlFormat)?e.replace("\\{",b).replace("\\}",m).replace("\\[",y).replace("\\]",v):e):this._urlFormatHold&&delete this._urlFormatHold,this.makeMatchsMap()}},{key:"makeMatchsMap",value:function(){var e=this;if(!this.matchsMap||this._matchsUrl!==this.urlFormat){this.matchsMap={},this._matchsUrl=this.urlFormat;for(var r=void 0,t=function(){var t={match:r[0],prefix:r[1],key:r[2],suffix:r[4]};r[3]&&r[3].split(":").forEach(function(e){e&&(t.dictate||(t.dictate=new Array),t.dictate.push(e))});e.matchsMap[t.key]=t};null!=(r=d.exec(this._matchsUrl));)t()}return this.matchsMap}},{key:"recoverUrl",value:function(e){return this._urlFormatHold?(t=e)?t.replace(b,"{").replace(m,"}").replace(y,"[").replace(v,"]"):t:e;var t}},{key:"analysis",value:function(i){var o=this;this.reSetUrlFormat(),i||(i={});var s=void 0,u=this.urlFormat,c=this.matchsMap;if(c)for(var e in c)if(!(e in i)){var t=c[e];u=u.replace(t.match,"")}var r=function(e){var t=c[e],r=i[e]||"",n=o.serializater||g;r=n(r);var a=t&&t.dictate||o.dictate;a?a.forEach(function(e){var t=o.dictateMap(e);t&&(r=t(r))}):o.processors&&o.processors.forEach(function(e){r=e(r)}),t?(r=r?(t.prefix||"")+r+(t.suffix||""):"",u=u.replace(t.match,r)):(r||(r=""),s||(s=""),s+=(s?"&":"")+e+"="+r)};for(var n in i)r(n);u=u?this.recoverUrl(u):"";var a=this.baseUrl+u;return s&&(a+=(a.indexOf("?")<0?"?":"&")+s),a}},{key:"urlFormat",get:function(){return this._urlFormatHold||this._urlFormat}}]),a}(),C={i:function(e){for(var t,r=arguments.length,n=Array(1<r?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];(t=console).log.apply(t,[e+":"].concat(c(n)))},d:function(e){for(var t,r=arguments.length,n=Array(1<r?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];(t=console).debug.apply(t,[e+":"].concat(c(n)))},w:function(e){for(var t,r=arguments.length,n=Array(1<r?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];(t=console).warn.apply(t,[e+":"].concat(c(n)))},e:function(e){for(var t,r=arguments.length,n=Array(1<r?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];(t=console).error.apply(t,[e+":"].concat(c(n)))}};function k(e){C.e("EasyHttp-ResponseError",e&&e.toString()||e)}var j=function(e){function n(e,t){i(this,n);var r=u(this,(n.__proto__||s(n)).call(this,e));return r.ro=t,r}return t(n,p),o(n,[{key:"createHandler",value:function(){var u=this,c=!1,t=function e(s){return new a(function(t,r){var e=this.getUrl(s);C.i("EasyHttp-Url",e);var n=u.ro.action,a=u.actionMap(n);if(a)if(h(a,Function))a(function(e){return C.i("\nEasyHttp-Response",e&&null!=e.data&&e.data||e),t(e)},function(e){return c?r(e):(u.errorHandler||k)(e)},e);else{var i=n?"the action:'"+n+"' is not Function":"default action is not Function";C.w("EasyHttp",i)}else{var o=n?"not found the action:'"+n+"'":"not found default action";C.w("EasyHttp",o)}}.bind(e))};return Object.defineProperty(t,"getUrl",{get:function(){return function(e){return u.ro.analysis(e)}}}),Object.defineProperty(t,"header",{get:function(){return function(e){return t.header=e,t}}}),Object.defineProperty(t,"catch",{get:function(){return function(e){return c=e,t}}}),t}},{key:"handler",get:function(){return this.createHandler()}}]),n}(),w=[e("requestOptions"),e("requesters"),e("configure"),e("getRequestItem")],F=w[0],O=w[1],P=w[2],H=w[3],U=function(){function r(e,t){i(this,r),this[P]=new n,this.setBaseUrl(e).addRequests(t)}return o(r,[{key:H,value:function(e){return this[O]||(this[O]={}),e in this[F]&&!(e in this[O])&&(this[O][e]=new j(this[P],this[F][e])),this[O]&&this[O][e]}}]),r}();Object.defineProperty(U.prototype,"addRequests",{configurable:!1,enumerable:!1,get:function(){return function(e){var r=this;if(e){this[F]||(this[F]={});var t=function(t){r[F][t]=new _(r[P],e[t]),l(r,t,{get:function(){var e=this[H](t);return e&&e.handler}})};for(var n in e)t(n)}return this}.bind(this)}});for(var A=["setBaseUrl","bindAction","bindDictate","setSerializater","setErrorHandler","addProcessor","setEscape","use"],q=A.length,E=function(e){var t=A[e];l(U,t,{configurable:!1,enumerable:!1,get:function(){return function(){return f[t].apply(f,arguments),this}.bind(this)}}),l(U.prototype,t,{configurable:!1,enumerable:!1,get:function(){return function(){var e;return(e=this[P])[t].apply(e,arguments),this}.bind(this)}})},M=0;M<q;M++)E(M);return U});