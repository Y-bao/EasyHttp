/*
* easy-http v1.1.0
* (c) 2018-2019 PengYuan-Jiang
*/
var t,e;t=this,e=function(){"use strict";var t=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},e=function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(r){t(e,r,n[r])})}return e},r=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}},n=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)},i=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")},a=function(t){return r(t)||n(t)||i()},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=function(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),t};function c(t,e){return null==t?t===e:t.constructor===e||t instanceof e}function d(t){if(t){for(var e,r=t.split(":"),n=0,i=r.length;n<i;n++){var a=r[n];a&&(e||(e=[])).push(a)}return e}}var f=/(?:{([^{}]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^{}]*)})?/gi,l={TEXT:"text",CMD:"cmd"},h=Symbol("privateScope"),p=function(){function t(e){o(this,t),this[h]={};var r=e;if(r){for(var n,i,a=this[h].nodes=[],s=0;i=f.exec(r);){n||(n=this[h].keys=[]);var u=i.index;s<u&&a.push({type:l.TEXT,data:r.substring(s,u)});var c=i[2],p=d(i[3])||void 0;a.push({type:l.CMD,data:{key:c,dictates:p||void 0,prefix:i[1]||void 0,suffix:i[4]||void 0}}),n[c]=1,s=u+i[0].length}var y=r.length;s<y&&a.push({type:l.TEXT,data:r.substring(s,y)})}}return u(t,[{key:"toRequestTpl",value:function(){if(!this.nodes)return"";for(var t="",e=0,r=this.nodes.length;e<r;e++){var n=this.nodes[e],i="";switch(n.type){case l.CMD:i=n.data.key,n.data.dictates&&(i="".concat(i,":").concat(n.data.dictates.join(":"))),i="{".concat(i,"}"),(n.data.prefix||n.data.suffix)&&(i="{".concat(n.data.prefix||"").concat(i).concat(n.data.suffix||"","}"));break;case l.TEXT:default:i=n.data}t+=i}return t}},{key:"nodes",get:function(){return this[h].nodes}},{key:"keys",get:function(){return this[h].keys}}]),t}(),y=Symbol("privateScope"),v=function(){function t(e,r){var n;(o(this,t),this[y]={conf:e},r)&&(c(r,Object)?((n=r.method||r.m)&&(this[y].method=n),(n=r.urlFormat||r.u)&&(this[y].urlFormat=n),this[y].dictates=d(r.dictate||r.d)):this[y].urlFormat=r)}return u(t,[{key:"createUrl",value:function(t){var r=this.odl&&this.odl.nodes;t=e({},t||{});for(var n="",i=0,a=r&&r.length||0;i<a;i++){var o=r[i],s=void 0;switch(o.type){case l.TEXT:s=o.data;break;case l.CMD:var u=o.data,c=t[u.key];if(delete t[u.key],void 0===(c=this.dictateHandle(c,u.dictates)))continue;s=(u.prefix||"")+c+(u.suffix||"")}n+=s}var d,f=this.baseUrl+n;for(var h in t){var p=t[h];void 0!==(p=this.dictateHandle(p))&&(d=(d?d+"&":"")+h+"="+p)}return d&&(f+=(f.indexOf("?")<0?"?":"&")+d),f}},{key:"dictateHandle",value:function(t,e){var r=this[y].conf;return t=r.serializater(t),(e||(e=this.dictates))&&e.forEach(function(e){var n=r.getDictateHandler(e);n&&(t=n(t))}),t}},{key:"baseUrl",get:function(){return this[y].conf.baseUrl||""}},{key:"method",get:function(){return this[y].method||this[y].conf.defaultMethod}},{key:"urlFormat",get:function(){return this[y].urlFormat}},{key:"dictates",get:function(){return this[y].dictates||this[y].conf.dictates}},{key:"odl",get:function(){return"odl"in this[y]||(this[y].odl=this.urlFormat&&new p(this.urlFormat)||void 0),this[y].odl}}]),t}(),b=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;o(this,t),this.interceptors=e,this.index=r}return u(t,[{key:"proceed",value:function(e){if(this.index>=this.interceptors.length)throw"It's the last interceptor";var r=new t(this.interceptors,this.index+1);return this.interceptors[this.index](e,function(t){return r.proceed(t)})}}]),t}();function g(t,e){return t(e={exports:{}},e.exports),e.exports}var m=g(function(t){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(n){return"function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?t.exports=r=function(t){return e(t)}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},r(n)}t.exports=r}),H=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},k=function(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?H(t):e},x=g(function(t){function e(r){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(r)}t.exports=e}),w=g(function(t){function e(r,n){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e(r,n)}t.exports=e}),O=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)},S=function(t){return c(t,Object)&&(t=JSON.stringify(t)),t},j=Symbol("privateScope"),D=function(){function t(){o(this,t),this[j]={}}return u(t,[{key:"init",value:function(t){t&&(this.setBaseUrl(t.baseUrl),this.setDefaultMethod(t.defaultMethod),this.setDictate(t.dictate),this.setHeaders(t.headers),this.setRequestHandler(t.requestHandler),this.setInterceptor(t.interceptors),this.setSerializater(t.serializater))}},{key:"setBaseUrl",value:function(t){return this[j].baseUrl=t||void 0,this}},{key:"setDefaultMethod",value:function(t){return this[j].defaultMethod=t,this}},{key:"setDictate",value:function(t){return this[j].dictates=d(t),this}},{key:"setHeaders",value:function(t){return this[j].headers=t?e({},t):void 0,this}},{key:"addHeaders",value:function(t){return t?(this[j].headers?this[j].headers=e({},this[j].headers,t):this[j].headers=e({},t),this):this}},{key:"removeHeaders",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this[j].headers&&r&&r.length>0&&r.forEach(function(e){e in t[j].headers&&delete t[j].headers[e]})}},{key:"setRequestHandler",value:function(t){return this[j].requestHandler=t||void 0,this}},{key:"setInterceptor",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e&&e.length>0?this[j].interceptors=[].concat(e):this[j].interceptors=null}},{key:"addInterceptor",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n;e&&e.length>0&&(this[j].interceptors||(this[j].interceptors=[]),(n=this[j].interceptors).push.apply(n,e));return this}},{key:"setDictateHandler",value:function(t){return this[j].dictateHandlers=t?e({},t):void 0,this}},{key:"addDictateHandler",value:function(t){return t?(this[j].dictateHandlers?this[j].dictateHandlers=e({},this[j].dictateHandlers,t):this[j].dictateHandlers=e({},t),this):this}},{key:"removeDictateHandler",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this[j].dictateHandlers&&r&&r.length>0&&r.forEach(function(e){e in t[j].dictateHandlers&&delete t[j].dictateHandlers[e]})}},{key:"setSerializater",value:function(t){return this[j].serializater=t,this}}]),t}(),U=new D,q=function(t){function e(){return o(this,e),k(this,x(e).apply(this,arguments))}return O(e,D),u(e,[{key:"getter",get:function(){if(this[j].getter)return this[j].getter;var t=this;return this[j].getter={get headers(){return t[j].headers||U[j].headers},get defaultMethod(){return(t[j].defaultMethod||U[j].defaultMethod||"get").toLowerCase()},get dictates(){return t[j].dictates||U[j].dictates},get baseUrl(){return t[j].baseUrl||U[j].baseUrl},get serializater(){return t[j].serializater||U[j].serializater||S},get requestHandler(){return t[j].requestHandler||U[j].requestHandler},get interceptors(){return t[j].interceptors||U[j].interceptors},getDictateHandler:function(e){return t[j].dictateHandlers&&t[j].dictateHandlers[e]||U[j].dictateHandlers&&U[j].dictateHandlers[e]}},this[j].getter}}]),e}(),E=[],T=[],z=Symbol("privateScope"),M=function(){function t(e,r){o(this,t),this[z]={conf:new q},this.setBaseUrl(e).addRequests(r)}return u(t,[{key:"request",value:function(t){var r,n=this[z].conf.getter,i=n.requestHandler,o=[].concat(a(n.interceptors||E),[function(t){return i(t)}]),s=new b(o);return r=t.coverHeaders?t.headers||T:e({},n.headers||T,t.headers||T),s.proceed({url:t.url||"",method:t.method||"",data:t.data,headers:r,extraData:t.extraData})}},{key:"createHandler",value:function(t){var e=this,r=function r(n){var i,a,o,s,u,c;return a=t.method,n?(i=r.getUrl(n.params),o=n.data,s=n.headers,u=n.coverHeaders,c=n.extraData):i=r.getUrl(),e.request({url:i,method:a,data:o,headers:s,coverHeaders:u,extraData:c})};return r.getUrl=function(e){return t.createUrl(e)},r}}]),t}();Object.defineProperty(M.prototype,"addRequests",{configurable:!1,enumerable:!1,get:function(){return function(t){var e=this;if(!t)return this;var r=function(r){var n=new v(e[z].conf.getter,t[r]);Object.defineProperty(e,r,{get:function(){return this.createHandler(n)}})};for(var n in t)r(n);return this}.bind(this)}});for(var P=["init","setBaseUrl","setDefaultMethod","setDictate","setHeaders","addHeaders","removeHeaders","setRequestHandler","setInterceptor","addInterceptor","setDictateHandler","addDictateHandler","removeDictateHandler","setSerializater"],_=P.length,A=function(t){var e=P[t];Object.defineProperty(M,e,{configurable:!1,enumerable:!1,get:function(){return function(){return U[e].apply(U,arguments),this}.bind(this)}}),Object.defineProperty(M.prototype,e,{configurable:!1,enumerable:!1,get:function(){return function(){var t;return(t=this[z].conf)[e].apply(t,arguments),this}.bind(this)}})},F=0;F<_;F++)A(F);return M},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).EasyHttp=e();