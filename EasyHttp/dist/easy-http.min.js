/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.EasyHttp=n()}(this,function(){"use strict";var l={i:function(t,n){console.log(t+": "+n)},d:function(t,n){console.debug(t+": "+n)},w:function(t,n){console.warn(t+": "+n)},e:function(t,n){console.error(t+": "+n)}},t=function(){function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}}();var o=/(?:\[([^{[]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,n=[Symbol("createSrc"),Symbol("getRequestItem"),Symbol("createRequestItem"),Symbol("createHandler"),Symbol("analysis"),Symbol("baseUrl"),Symbol("src"),Symbol("requests"),Symbol("dictateMap"),Symbol("actionMap"),Symbol("serializater"),Symbol("processors"),Symbol("logConfig")],a=n[0],u=n[1],e=n[2],c=n[3],h=n[4],y=n[5],s=n[6],r=n[7],d=n[8],v=n[9],b=n[10],p=n[11],m=n[12];function g(t,n){return null==t?t===n:t.constructor===n||t instanceof n}function k(t){return g(t,Object)&&(t=JSON.stringify(t)),t}return function(){function f(t,e){var i=this;if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,f),this[y]=t,e){this[s]={};var n=function(n){i[s][n]=i[a](e[n]),Object.defineProperty(i,n,{get:function(){var t=this[u](n);return t&&t.handler}})};for(var r in e)n(r)}}return t(f,[{key:a,value:function(t){var n=void 0;if(t&&g(t,Object)){n={action:t.action||t.a,urlFormat:t.urlFormat||t.u};var e=t.dictate||t.d;if(e)e.split(":").forEach(function(t){t&&(n.dictate||(n.dictate=new Array),n.dictate.push(t))})}else n={urlFormat:t};return n}},{key:u,value:function(t){return this[r]||(this[r]={}),t in this[s]&&!(t in this[r])&&(this[r][t]=this[e](this[s][t])),this[r]&&this[r][t]}},{key:e,value:function(t){for(var e={},i=void 0,n=function(){var n={match:i[0],prefix:i[1],key:i[2],suffix:i[4]};i[3]&&i[3].split(":").forEach(function(t){t&&(n.dictate||(n.dictate=new Array),n.dictate.push(t))});e.matchsArray||(e.matchsArray=new Array),e.matchsArray.push(n)};null!=(i=o.exec(t.urlFormat));)n();var r=this;return Object.defineProperty(e,"handler",{get:function(){return r[c](t,e)}}),e}},{key:c,value:function(c,e){var r=this,s=!1,t=function t(u){return new Promise(function(n,e){function t(t){return l.e(t),!!s&&e(t)}var r=this.getUrl(u);i("EasyHttp-Url",r);var o=(c.action||"").toLowerCase(),a=this[v]&&this[v][o]||f[v]&&f[v][o];if(a){if(!g(a,Function))return void t(c.action?"the action:'"+c.action+"' is not Function":"default action is not Function");a(function(t){return l.i(t),n(t)},t,r)}else{t(c.action?"not found the action:'"+c.action+"'":"not found default action")}}.bind(t))},n=function(t){var n=r[h](c,e.matchsArray,t);return r[y]+n};Object.defineProperty(t,"getUrl",{get:function(){return n}});var o=function(t){return this.header=t,this}.bind(t);Object.defineProperty(t,"header",{get:function(){return o}});var a=function(){return s=!0,arguments&&0<arguments.length?this.apply(void 0,arguments):this}.bind(t);return Object.defineProperty(t,"c",{get:function(){return a}}),t}},{key:h,value:function(a,t,u){var c=this,s=a.urlFormat;return t&&(u||(u={}),t.forEach(function(t){var n=t.key,e=u[n],i=c[b]||f[b]||k;e=i(e);var r=t.dictate||a.dictate;if(r)r.forEach(function(t){var n=c[d]&&c[d][t]||f[d]&&f[d][t];n&&(e=n(e))});else{var o=c[o]||f[o];o&&o.forEach(function(t){e=t(e)})}e=e?(t.prefix||"")+e+(t.suffix||""):"",s=s.replace(t.match,e)})),s||(s=""),s}},{key:"bindAction",value:function(t,n){t||(t=""),this[v]||(this[v]={}),n&&(this[v][t.toLowerCase()]=n)}},{key:"bindDictate",value:function(t,n){this[d]||(this[d]={}),t&&n&&(this[d][t.toLowerCase()]=n)}},{key:"setSerializater",value:function(t){this[b]=t}},{key:"addProcessor",value:function(){for(var t,n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];this[p]||(this[p]=new Array),e&&(t=this[p]).push.apply(t,e)}},{key:"use",value:function(t){t&&t.install&&g(t.install,Function)&&t.install(this)}}],[{key:"bindAction",value:function(t,n){t||(t=""),this[v]||(this[v]={}),n&&(this[v][t.toLowerCase()]=n)}},{key:"bindDictate",value:function(t,n){this[d]||(this[d]={}),t&&n&&(this[d][t.toLowerCase()]=n)}},{key:"setSerializater",value:function(t){this[b]=t}},{key:"addProcessor",value:function(){for(var t,n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];this[p]||(this[p]=new Array),e&&(t=this[p]).push.apply(t,e)}},{key:"use",value:function(t){t&&t.install&&g(t.install,Function)&&t.install(this)}},{key:"logConfig",value:function(t){this[m]=t}}]),f}()});