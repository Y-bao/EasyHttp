/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.EasyHttp=n()}(this,function(){"use strict";var l={i:function(t,n){console.log(t+":",n)},d:function(t,n){console.debug(t+":",n)},w:function(t,n){console.warn(t+":",n)},e:function(t,n){console.error(t+":",n)}},t=function(){function r(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),t}}();var a=/(?:\[([^[{]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,n=[Symbol("createSrc"),Symbol("getRequestItem"),Symbol("createRequestItem"),Symbol("createHandler"),Symbol("analysis"),Symbol("baseUrl"),Symbol("src"),Symbol("requests"),Symbol("dictateMap"),Symbol("actionMap"),Symbol("serializater"),Symbol("processors"),Symbol("errorHandler"),Symbol("logConfig"),Symbol("isHold")],o=n[0],u=n[1],e=n[2],c=n[3],r=n[4],d=n[5],s=n[6],i=n[7],p=n[8],y=n[9],v=n[10],b=n[11],m=n[12],f=n[13],g=n[14];function S(t,n){return null==t?t===n:t.constructor===n||t instanceof n}function w(t){return S(t,Object)&&(t=JSON.stringify(t)),t}function H(t){l.e("EasyHttp-ResponseError",t&&t.toString()||t)}var E="*:hold-bl:*",j="*:hold-br:*",F="*:hold-ml:*",O="*:hold-mr:*";var h=function(){function h(t,e){var r=this;if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,h),this[d]=t||"",e){this[s]={};var n=function(n){r[s][n]=r[o](e[n]),Object.defineProperty(r,n,{get:function(){var t=this[u](n);return t&&t.handler}})};for(var i in e)n(i)}}return t(h,[{key:o,value:function(t){var n=void 0;if(t&&S(t,Object)){n={action:t.action||t.a,urlFormat:t.urlFormat||t.u,isHold:t.hold||t.h};var e=t.dictate||t.d;if(e)e.split(":").forEach(function(t){t&&(n.dictate||(n.dictate=new Array),n.dictate.push(t))})}else n={urlFormat:t};return n}},{key:u,value:function(t){return this[i]||(this[i]={}),t in this[s]&&!(t in this[i])&&(this[i][t]=this[e](this[s][t])),this[i]&&this[i][t]}},{key:e,value:function(t){var n,e={},r=void 0;(t.isHold||this[g]||h[g])&&(t.urlFormat=(n=t.urlFormat)?n.replace("\\{",E).replace("\\}",j).replace("\\[",F).replace("\\]",O):n);for(var i=function(){var n={match:r[0],prefix:r[1],key:r[2],suffix:r[4]};r[3]&&r[3].split(":").forEach(function(t){t&&(n.dictate||(n.dictate=new Array),n.dictate.push(t))});e.matchsMap||(e.matchsMap={}),e.matchsMap[n.key]=n};null!=(r=a.exec(t.urlFormat));)i();var o=this;return Object.defineProperty(e,"handler",{get:function(){return o[c](t,e)}}),e}},{key:c,value:function(c,e){var s=this,f=!1,n=function t(u){return new Promise(function(n,e){var t=this.getUrl(u);l.i("EasyHttp-Url",t);var r=(c.action||"get").toLowerCase(),i=s[y]&&s[y][r]||h[y]&&h[y][r];if(i)if(S(i,Function))i(function(t){return l.i("EasyHttp-Response",t&&null!=t.data&&t.data||t),n(t)},function(t){return f?e(t):(s[m]||h[m]||H)(t)},t);else{var o=r?"the action:'"+r+"' is not Function":"default action is not Function";l.w("EasyHttp",o)}else{var a=r?"not found the action:'"+r+"'":"not found default action";l.w("EasyHttp",a)}}.bind(t))};return Object.defineProperty(n,"getUrl",{get:function(){return function(t){var n=s[r](c,e.matchsMap,t);return s[d]+n}}}),Object.defineProperty(n,"header",{get:function(){return function(t){return n.header=t,n}}}),Object.defineProperty(n,"catch",{get:function(){return function(t){return f=t,n}}}),n}},{key:r,value:function(r){function t(t,n,e){return r.apply(this,arguments)}return t.toString=function(){return r.toString()},t}(function(a,u,c){var s=this,f=a.urlFormat,l="";c||(c={}),u||(u={});var t,n=function(t){var n=u[t],e=c[t]||"",r=s[v]||h[v]||w;e=r(e);var i=n&&n.dictate||a.dictate;if(i)i.forEach(function(t){var n=s[p]&&s[p][t]||h[p]&&h[p][t];n&&(e=n(e))});else{var o=s[b]||h[b];o&&o.forEach(function(t){e=t(e)})}n?(e=e?(n.prefix||"")+e+(n.suffix||""):"",f=f.replace(n.match,e)):(e||(e=""),l+=(l?"&":"?")+t+"="+e)};for(var e in c)n(e);if(u)for(var e in u)if(!(e in c)){var r=u[e];f=f.replace(r.match,value)}return(f+=l)||(f=""),a.isHold||this[g]||h[g]?(t=f)?t.replace(E,"{").replace(j,"}").replace(F,"[").replace(O,"]"):t:f})}],[{key:"logConfig",value:function(t){this[f]=t}}]),h}(),P={bindAction:function(t,n){if(t||(t=""),this[y]||(this[y]={}),n)return this[y][t.toLowerCase()]=n,this},bindDictate:function(t,n){if(this[p]||(this[p]={}),t&&n)return this[p][t.toLowerCase()]=n,this},setSerializater:function(t){return this[v]=t,this},setErrorHandler:function(t){return this[m]=t,this},setIsHold:function(t){return this[g]=t,this},addProcessor:function(){for(var t,n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];if(this[b]||(this[b]=new Array),e)return(t=this[b]).push.apply(t,e),this},use:function(t){return t&&t.install&&S(t.install,Function)&&t.install(this),this}},k=function(t){Object.defineProperty(h,t,{get:function(){return function(){return P[t].apply(this,arguments)}.bind(this)}}),Object.defineProperty(h.prototype,t,{get:function(){return function(){return P[t].apply(this,arguments)}.bind(this)}})};for(var x in P)k(x);return h});