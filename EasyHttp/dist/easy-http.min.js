/*
* easy-http v1.0.3
* (c) 2018-2019 PengYuan-Jiang
*/
var t,e;t=this,e=function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t},n=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},i=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),i.forEach(function(e){n(t,e,r[e])})}return t};function o(t,e){return null==t?t===e:t.constructor===e||t instanceof e}var s={initDictate:function(t){if(t){for(var e,r=t.split(":"),n=0,i=r.length;n<i;n++){var o=r[n];o&&(e||(e=[])).push(o)}return e}}},a=/(?:{([^{}]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^{}]*)})?/gi,u={TEXT:"text",CMD:"cmd"},c=Symbol("privateScope"),f=function(){function e(r){t(this,e),this[c]={};var n=r;if(n){for(var i,o,f=this[c].nodes=[],l=0;o=a.exec(n);){i||(i=this[c].keys=[]);var h=o.index;l<h&&f.push({type:u.TEXT,data:n.substring(l,h)});var d=o[2],p=s.initDictate(o[3])||void 0;f.push({type:u.CMD,data:{key:d,dictates:p||void 0,prefix:o[1]||void 0,suffix:o[4]||void 0}}),i[d]=1,l=h+o[0].length}var y=n.length;l<y&&f.push({type:u.TEXT,data:n.substring(l,y)})}}return r(e,[{key:"toRequestTpl",value:function(){if(!this.nodes)return"";for(var t="",e=0,r=this.nodes.length;e<r;e++){var n=this.nodes[e],i="";switch(n.type){case u.CMD:i=n.data.key,n.data.dictates&&(i="".concat(i,":").concat(n.data.dictates.join(":"))),i="{".concat(i,"}"),(n.data.prefix||n.data.suffix)&&(i="{".concat(n.data.prefix||"").concat(i).concat(n.data.suffix||"","}"));break;case u.TEXT:default:i=n.data}t+=i}return t}},{key:"nodes",get:function(){return this[c].nodes}},{key:"keys",get:function(){return this[c].keys}}]),e}(),l=Symbol("privateScope"),h=function(){function e(r,n){var i;(t(this,e),this[l]={configGetter:r},n)&&(o(n,Object)?((i=n.action||n.a)&&(this[l].action=i),(i=n.urlFormat||n.u)&&(this[l].urlFormat=i),(i=n.dictate||n.d)&&(this[l].requestDictate=i)):this[l].urlFormat=n)}return r(e,[{key:"analysis",value:function(t){var e=this,r=this.odl.nodes;t=i({},t||{});for(var n="",o=0,s=r.length;o<s;o++){var a=r[o],c=void 0;"continue"!==function(){switch(a.type){case u.TEXT:c=a.data;break;case u.CMD:var r=a.data,n=t[r.key];delete t[r.key];var i=e.serializater;if(n=i(n),r.dictates&&r.dictates.forEach(function(t){var r=e.dictateMap(t);r&&(n=r(n))}),void 0===n)return"continue";c=(r.prefix||"")+n+(r.suffix||"")}}()&&(n+=c)}var f,l=this.baseUrl+n;for(var h in t){var d=t[h];void 0!==d&&(f=(f?f+"&":"")+h+"="+d)}return f&&(l+=(l.indexOf("?")<0?"?":"&")+f),l}},{key:"conf",get:function(){return this[l].configGetter}},{key:"action",get:function(){return this[l].action}},{key:"urlFormat",get:function(){return this[l].urlFormat}},{key:"requestDictate",get:function(){return this[l].requestDictate}},{key:"odl",get:function(){return["odl"]in this[l]||(this[l].odl=this.urlFormat&&new f(this.urlFormat)||void 0),this[l].odl}}]),e}(),d=function(){function e(r){t(this,e),this.ro=r}return r(e,[{key:"createHandler",value:function(){var t,e=this,r=function t(r){var n=new Promise(function(n,o){var s=t.getUrl(r&&r.params),a=e.ro.action,u={url:s,params:r&&r.params,action:a,data:r&&r.data,other:r&&r.other,header:r.header?i({},t.getHeader(),r.header):t.getHeader()},c=e.ro.handler;if(c){var f=e.ro.preHandlers;if(f&&f.length>0)for(var l=0,h=f.length;l<h;l++)if(f[l](u,n,o))return;try{c(u).then(function(t){n({request:u,response:t})}).catch(function(t){o({errType:0,request:u,response:t})})}catch(t){o({errType:-1,request:u,msg:t})}}else o({errType:-1,request:u,msg:"not found handler"})}),o=e.ro.postHandlers;return o&&o.length>0?Promise.resolve().then(function(){for(var t=n,e=0,r=o.length;e<r;e++)t=o[e](t);return t}):n};return r.setHeader=function(e){return t=e?i({},e):null,r},r.addHeader=function(e){return e?(t=i({},this.getHeader(),e),r):r},r.getHeader=function(){return t||e.ro.header},r.getUrl=function(t){return e.ro.analysis(t)},r}},{key:"handler",get:function(){return this.createHandler()}}]),e}();function p(t,e){return t(e={exports:{}},e.exports),e.exports}var y=p(function(t){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(n){return"function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?t.exports=r=function(t){return e(t)}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},r(n)}t.exports=r}),v=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},g=function(t,e){return!e||"object"!==y(e)&&"function"!=typeof e?v(t):e},b=p(function(t){function e(r){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(r)}t.exports=e}),m=p(function(t){function e(r,n){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e(r,n)}t.exports=e}),H=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)},k=function(t){return o(t,Object)&&(t=JSON.stringify(t)),t},I=Symbol("privateScope"),w=function(){function e(){t(this,e),this[I]={}}return r(e,[{key:"init",value:function(t){t&&(this.setBaseUrl(t.baseUrl),this.setAction(t.action),this.setDictate(t.dictate),this.setHeaders(t.headers),this.setRequestHandler(t.requestHandler),this.setPreInterceptor(t.preInterceptors),this.setPostInterceptor(t.postInterceptors),this.setSerializater(t.serializater))}},{key:"setBaseUrl",value:function(t){return this[I].baseUrl=t||void 0,this}},{key:"setAction",value:function(t){return this[I].action=t,this}},{key:"setDictate",value:function(t){return this[I].dictates=s.initDictate(t),this}},{key:"setHeaders",value:function(t){return this[I].headers=t?i({},t):void 0,this}},{key:"addHeaders",value:function(t){return t?(this[I].headers?this[I].headers=i({},this[I].headers,t):this[I].headers=i({},t),this):this}},{key:"removeHeaders",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this[I].headers&&r&&r.length>0&&r.forEach(function(e){e in t[I].headers&&delete t[I].headers[e]})}},{key:"setRequestHandler",value:function(t){return this[I].requestHandler=t||void 0,this}},{key:"setPreInterceptor",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e&&e.length>0?this[I].preInterceptors=[].concat(e):this[I].preInterceptors=null}},{key:"addPreInterceptor",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n;e&&e.length>0&&(this[I].preInterceptors||(this[I].preInterceptors=[]),(n=this[I].preInterceptors).push.apply(n,e));return this}},{key:"setPostInterceptor",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e&&e.length>0?this[I].postInterceptors=[].concat(e):this[I].postInterceptors=void 0,this}},{key:"addPostInterceptor",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n;e&&e.length>0&&(this[I].postInterceptors||(this[I].postInterceptors=[]),(n=this[I].postInterceptors).push.apply(n,e));return this}},{key:"setDictateHandler",value:function(t){return this[I].dictateHandlers=t?i({},t):void 0,this}},{key:"addDictateHandler",value:function(t){return t?(this[I].dictateHandlers?this[I].dictateHandlers=i({},this[I].dictateHandlers,t):this[I].dictateHandlers=i({},t),this):this}},{key:"removeDictateHandler",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this[I].dictateHandlers&&r&&r.length>0&&r.forEach(function(e){e in t[I].dictateHandlers&&delete t[I].dictateHandlers[e]})}},{key:"setSerializater",value:function(t){return this[I].serializater=t,this}},{key:"use",value:function(t){return t.install(this),this}}]),e}(),O=new w,S=function(e){function n(){return t(this,n),g(this,b(n).apply(this,arguments))}return H(n,w),r(n,[{key:"configureGetter",get:function(){this[I].configGetter||(this[I].configGetter={get defaultHeaders(){return this[I].headers||O[I].headers},get defaultAction(){return(this[I].action||O[I].action||"get").toLowerCase()},get defaultDictates(){return this[I].dictates||O[I].dictates},get baseUrl(){return this[I].baseUrl||O[I].baseUrl},get serializater(){return this[I].serializater||O[I].serializater||k},get requestHandler(){return this[I].requestHandler||O[I].requestHandler},get preInterceptors(){return this[I].preInterceptors||O[I].preInterceptors},get postInterceptors(){return this[I].postInterceptors||O[I].postInterceptors},dictateMap:function(t){return this[I].dictateHandlers&&this[I].dictateHandlers[t]||O[I].dictateHandlers&&O[I].dictateHandlers[t]}})}}]),n}(),x=[Symbol("requestOptions"),Symbol("requesters"),Symbol("configure"),Symbol("getRequestItem")],P=x[0],q=x[1],D=x[2],j=x[3],T=function(){function e(r,n){t(this,e),this[D]=new S,this.setBaseUrl(r).addRequests(n)}return r(e,[{key:j,value:function(t){return this[q]||(this[q]={}),t in this[P]&&!(t in this[q])&&(this[q][t]=new d(this[P][t])),this[q]&&this[q][t]}}]),e}();Object.defineProperty(T.prototype,"addRequests",{configurable:!1,enumerable:!1,get:function(){return function(t){var e=this;if(t){this[P]||(this[P]={});var r=function(r){e[P][r]=new h(e[D].configureGetter,t[r]),Object.defineProperty(e,r,{get:function(){var t=this[j](r);return t&&t.handler}})};for(var n in t)r(n)}return this}.bind(this)}});for(var z=["init","setBaseUrl","setAction","setDictate","setHeaders","addHeaders","removeHeaders","setRequestHandler","setPreInterceptor","addPreInterceptor","setPostInterceptor","addPostInterceptor","setDictateHandler","addDictateHandler","removeDictateHandler","setSerializater"],E=z.length,U=function(t){var e=z[t];Object.defineProperty(T,e,{configurable:!1,enumerable:!1,get:function(){return function(){return O[e].apply(O,arguments),this}.bind(this)}}),Object.defineProperty(T.prototype,e,{configurable:!1,enumerable:!1,get:function(){return function(){var t;return(t=this[D])[e].apply(t,arguments),this}.bind(this)}})},_=0;_<E;_++)U(_);return T},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).EasyHttp=e();