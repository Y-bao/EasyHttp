/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.EasyHttp=e()}(this,function(){"use strict";function t(t,e){return void 0==t?t===e:t.constructor===e||t instanceof e}var e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t};function r(t){if(t){let e;return t.split(":").forEach(t=>{t&&(e||(e=new Array),e.push(t))}),e}}function s(e){return t(e,Object)&&(e=JSON.stringify(e)),e}class i{setBaseUrl(t){return this.baseUrl=t||"",this}setHeader(t){return this.h=e({},t),this}addHeader(t){return this.h=this.h?e({},this.h,t):e({},t),this}bindHandler(t){return this.hd=t,this}bindPreHandler(){let t=arguments;return t&&t.length>0&&(this.prehd||(this.prehd=[]),this.prehd.push(...t)),this}bindPostHandler(){let t=arguments;return t&&t.length>0&&(this.posthd||(this.posthd=[]),this.posthd.push(...t)),this}bindDictate(t,e){return t&&e&&(this.dm||(this.dm={}),this.dm[t.toLowerCase()]=e),this}setAction(t){return this.defA=t,this}setDictate(t){return this.defD=r(t),this}setSerializater(t){return this.sz=t,this}setErrorHandler(t){return this.eh=t,this}setEscape(t){return this.esc=t,this}use(e){return e&&e.install&&t(e.install,Function)&&e.install(this),this}}const n=new i;class a{constructor(t){this.outConf=t}get header(){return this.outConf.h||n.h}set escape(t){t&&(this.esc=t)}get escape(){return void 0!=this.esc?this.esc:void 0!=this.outConf.esc?this.outConf.esc:void 0!=n.esc&&n.esc}set dictate(t){this.defD=r(t)}get dictate(){return this.defD||this.outConf.defD||n.defD}set action(t){this.defA=t}get action(){return(this.defA||this.outConf.defA||n.defA||"get").toLowerCase()}get baseUrl(){return this.outConf.baseUrl||n.baseUrl}get serializater(){return this.outConf.sz||n.sz||s}get errorHandler(){return this.outConf.eh||n.eh}get handler(){return this.outConf.hd||n.hd}get preHandlers(){return this.outConf.prehd||n.prehd}get postHandlers(){return this.outConf.posthd||n.posthd}dictateMap(t){return this.outConf.dm&&this.outConf.dm[t]||n.dm&&n.dm[t]}}const o=/(?:\[([^[{]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,h="*:hold-bl:*",l="*:hold-br:*",u="*:hold-ml:*",c="*:hold-mr:*";class d extends a{constructor(e,r){super(e),r&&(t(r,Object)?((r.action||r.a)&&(this.action=r.action||r.a),(r.urlFormat||r.u)&&(this._urlFormat=r.urlFormat||r.u),(r.escape||r.esc)&&(this.escape=r.escape||r.esc),this.dictate=r.dictate||r.d):this._urlFormat=r)}get urlFormat(){return this._urlFormatHold||this._urlFormat}reSetUrlFormat(){var t;this.escape?this._urlFormatHold||(this._urlFormatHold=(t=this._urlFormat)?t.replace("\\{",h).replace("\\}",l).replace("\\[",u).replace("\\]",c):t):this._urlFormatHold&&delete this._urlFormatHold,this.makeMatchsMap()}makeMatchsMap(){if(!this.matchsMap||this._matchsUrl!==this.urlFormat){let t;for(this.matchsMap={},this._matchsUrl=this.urlFormat;null!=(t=o.exec(this._matchsUrl));){let e={match:t[0],prefix:t[1],key:t[2],suffix:t[4]};if(t[3]){t[3].split(":").forEach(t=>{t&&(e.dictate||(e.dictate=new Array),e.dictate.push(t))})}this.matchsMap[e.key]=e}}return this.matchsMap}recoverUrl(t){return this._urlFormatHold?(e=t)?e.replace(h,"{").replace(l,"}").replace(u,"[").replace(c,"]"):e:t;var e}analysis(t){let e;this.reSetUrlFormat(),t||(t={});let r=this.urlFormat,s=this.matchsMap;if(s)for(let e in s)if(!(e in t)){let t=s[e];r=r.replace(t.match,"")}for(let i in t){let n=s[i],a=t[i]||"",o=this.serializater;a=o(a);let h=n&&n.dictate||this.dictate;h&&h.forEach(t=>{let e=this.dictateMap(t);e&&(a=e(a))}),n?(a=a?(n.prefix||"")+a+(n.suffix||""):"",r=r.replace(n.match,a)):(a||(a=""),e||(e=""),e+=(e?"&":"")+i+"="+a)}r=r?this.recoverUrl(r):"";let i=this.baseUrl+r;return e&&(i+=(i.indexOf("?")<0?"?":"&")+e),i}}var f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t};class p{constructor(t){this.ro=t}get handler(){return this.createHandler()}createHandler(){let t=this,e=function(r){return new Promise(function(e,s){let i=this.getUrl(r&&r.params),n=t.ro.action,a={url:i,action:n,data:r.data,header:this.getHeader()};function o(r,i,n,o){let h={code:r,data:i,header:n,error:o},l=t.ro.postHandlers;if(l&&l.length>0)for(let t=0,r=l.length;t<r;t++)if(l[t](a,h,e,s))return!1;return h.code>0?e(h):s(h)}let h=t.ro.handler;if(h){let e=t.ro.preHandlers;if(e&&e.length>0)for(let t=0,r=e.length;t<r;t++)if(e[t](a,o))return;h(a,o)}else console.warn(`EasyHttp-Url: [${n}]${i}`),console.warn("EasyHttp-Warn:","not found handler","\n")}.bind(e))};return e.setHeader=function(t){return header=f({},t),e},e.addHeader=function(t){return header=f({},this.getHeader(),t),e},e.getHeader=function(){return e.header||t.ro.header||{}},e.getUrl=function(e){return t.ro.analysis(e)},e}}const[m,b,g,H]=[Symbol("requestOptions"),Symbol("requesters"),Symbol("configure"),Symbol("getRequestItem")];class y{constructor(t,e){this[g]=new i,this.setBaseUrl(t).addRequests(e)}[H](t){return this[b]||(this[b]={}),t in this[m]&&!(t in this[b])&&(this[b][t]=new p(this[m][t])),this[b]&&this[b][t]}}Object.defineProperty(y.prototype,"addRequests",{configurable:!1,enumerable:!1,get:function(){return function(t){if(t){this[m]||(this[m]={});for(let e in t)this[m][e]=new d(this[g],t[e]),Object.defineProperty(this,e,{get:function(){let t=this[H](e);return t&&t.handler}})}return this}.bind(this)}});const F=["setBaseUrl","setHeader","addHeader","bindHandler","bindPreHandler","bindPostHandler","bindDictate","setSerializater","setErrorHandler","setAction","setDictate","setEscape","use"],U=F.length;for(let t=0;t<U;t++){let e=F[t];Object.defineProperty(y,e,{configurable:!1,enumerable:!1,get:function(){return function(){return n[e](...arguments),this}.bind(this)}}),Object.defineProperty(y.prototype,e,{configurable:!1,enumerable:!1,get:function(){return function(){return this[g][e](...arguments),this}.bind(this)}})}return y});