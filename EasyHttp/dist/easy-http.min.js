/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("babel-runtime/helpers/toConsumableArray"),require("babel-runtime/helpers/extends"),require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("babel-runtime/core-js/json/stringify"),require("babel-runtime/core-js/object/get-prototype-of"),require("babel-runtime/helpers/possibleConstructorReturn"),require("babel-runtime/helpers/inherits"),require("babel-runtime/core-js/promise"),require("babel-runtime/core-js/object/define-property"),require("babel-runtime/core-js/symbol")):"function"==typeof define&&define.amd?define(["babel-runtime/helpers/toConsumableArray","babel-runtime/helpers/extends","babel-runtime/helpers/classCallCheck","babel-runtime/helpers/createClass","babel-runtime/core-js/json/stringify","babel-runtime/core-js/object/get-prototype-of","babel-runtime/helpers/possibleConstructorReturn","babel-runtime/helpers/inherits","babel-runtime/core-js/promise","babel-runtime/core-js/object/define-property","babel-runtime/core-js/symbol"],t):e.EasyHttp=t(e._toConsumableArray,e._extends,e._classCallCheck,e._createClass,e._JSON$stringify,e._Object$getPrototypeOf,e._possibleConstructorReturn,e._inherits,e._Promise,e._Object$defineProperty,e._Symbol)}(this,function(e,t,r,n,i,a,s,u,o,l,h){"use strict";function c(e,t){return void 0==e?e===t:e.constructor===t||e instanceof t}function f(e){if(e){var t=void 0;return e.split(":").forEach(function(e){e&&(t||(t=new Array),t.push(e))}),t}}function d(e){return c(e,Object)&&(e=i(e)),e}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n,i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a,s=s&&s.hasOwnProperty("default")?s.default:s,u=u&&u.hasOwnProperty("default")?u.default:u,o=o&&o.hasOwnProperty("default")?o.default:o,l=l&&l.hasOwnProperty("default")?l.default:l,h=h&&h.hasOwnProperty("default")?h.default:h;var p=function(){function i(){r(this,i)}return n(i,[{key:"setBaseUrl",value:function(e){return this.baseUrl=e||"",this}},{key:"setHeader",value:function(e){return this.h=t({},e),this}},{key:"addHeader",value:function(e){return this.h=this.h?t({},this.h,e):t({},e),this}},{key:"bindHandler",value:function(e){return this.hd=e,this}},{key:"bindPreHandler",value:function(){var t,r=arguments;r&&r.length>0&&(this.prehd||(this.prehd=[]),(t=this.prehd).push.apply(t,e(r)));return this}},{key:"bindPostHandler",value:function(){var t,r=arguments;r&&r.length>0&&(this.posthd||(this.posthd=[]),(t=this.posthd).push.apply(t,e(r)));return this}},{key:"bindDictate",value:function(e,t){return e&&t&&(this.dm||(this.dm={}),this.dm[e.toLowerCase()]=t),this}},{key:"setAction",value:function(e){return this.defA=e,this}},{key:"setDictate",value:function(e){return this.defD=f(e),this}},{key:"setSerializater",value:function(e){return this.sz=e,this}},{key:"setErrorHandler",value:function(e){return this.eh=e,this}},{key:"setEscape",value:function(e){return this.esc=e,this}},{key:"use",value:function(e){return e.install(this),this}}]),i}(),b=new p,m=function(){function e(t){r(this,e),this.outConf=t}return n(e,[{key:"dictateMap",value:function(e){return this.outConf.dm&&this.outConf.dm[e]||b.dm&&b.dm[e]}},{key:"header",get:function(){return this.outConf.h||b.h}},{key:"escape",set:function(e){e&&(this.esc=e)},get:function(){return void 0!=this.esc?this.esc:void 0!=this.outConf.esc?this.outConf.esc:void 0!=b.esc&&b.esc}},{key:"dictate",set:function(e){this.defD=f(e)},get:function(){return this.defD||this.outConf.defD||b.defD}},{key:"action",set:function(e){this.defA=e},get:function(){return(this.defA||this.outConf.defA||b.defA||"get").toLowerCase()}},{key:"baseUrl",get:function(){return this.outConf.baseUrl||b.baseUrl}},{key:"serializater",get:function(){return this.outConf.sz||b.sz||d}},{key:"errorHandler",get:function(){return this.outConf.eh||b.eh}},{key:"handler",get:function(){return this.outConf.hd||b.hd}},{key:"preHandlers",get:function(){return this.outConf.prehd||b.prehd}},{key:"postHandlers",get:function(){return this.outConf.posthd||b.posthd}}]),e}(),y=/(?:\[([^[{]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,v="*:hold-bl:*",g="*:hold-br:*",k="*:hold-ml:*",_="*:hold-mr:*";var C=function(e){function t(e,n){r(this,t);var i=s(this,(t.__proto__||a(t)).call(this,e));return n&&(c(n,Object)?((n.action||n.a)&&(i.action=n.action||n.a),(n.urlFormat||n.u)&&(i._urlFormat=n.urlFormat||n.u),(n.escape||n.esc)&&(i.escape=n.escape||n.esc),i.dictate=n.dictate||n.d):i._urlFormat=n),i}return u(t,m),n(t,[{key:"reSetUrlFormat",value:function(){var e;this.escape?this._urlFormatHold||(this._urlFormatHold=(e=this._urlFormat)?e.replace("\\{",v).replace("\\}",g).replace("\\[",k).replace("\\]",_):e):this._urlFormatHold&&delete this._urlFormatHold,this.makeMatchsMap()}},{key:"makeMatchsMap",value:function(){var e=this;if(!this.matchsMap||this._matchsUrl!==this.urlFormat){this.matchsMap={},this._matchsUrl=this.urlFormat;for(var t=void 0,r=function(){var r={match:t[0],prefix:t[1],key:t[2],suffix:t[4]};t[3]&&t[3].split(":").forEach(function(e){e&&(r.dictate||(r.dictate=new Array),r.dictate.push(e))});e.matchsMap[r.key]=r};null!=(t=y.exec(this._matchsUrl));)r()}return this.matchsMap}},{key:"recoverUrl",value:function(e){return this._urlFormatHold?(t=e)?t.replace(v,"{").replace(g,"}").replace(k,"[").replace(_,"]"):t:e;var t}},{key:"analysis",value:function(e){var t=this;this.reSetUrlFormat(),e||(e={});var r=void 0,n=this.urlFormat,i=this.matchsMap;if(i)for(var a in i)if(!(a in e)){var s=i[a];n=n.replace(s.match,"")}var u=function(a){var s=i[a],u=e[a]||"",o=t.serializater;u=o(u);var l=s&&s.dictate||t.dictate;l&&l.forEach(function(e){var r=t.dictateMap(e);r&&(u=r(u))}),s?(u=u?(s.prefix||"")+u+(s.suffix||""):"",n=n.replace(s.match,u)):(u||(u=""),r||(r=""),r+=(r?"&":"")+a+"="+u)};for(var o in e)u(o);n=n?this.recoverUrl(n):"";var l=this.baseUrl+n;return r&&(l+=(l.indexOf("?")<0?"?":"&")+r),l}},{key:"urlFormat",get:function(){return this._urlFormatHold||this._urlFormat}}]),t}(),H=function(){function e(t){r(this,e),this.ro=t}return n(e,[{key:"createHandler",value:function(){var e=this,r=function t(r){var n=new o(function(n,i){var a={url:t.getUrl(r&&r.params),action:e.ro.action,data:r&&r.data,other:r&&r.other,header:t.getHeader()};function s(e,t,r,i){n({request:a,response:{code:e,data:t,header:r,msg:i}})}function u(e,t,r,n){i({request:a,response:{code:e,data:t,header:r,msg:n}})}var o=e.ro.handler;if(o){var l=e.ro.preHandlers;if(l&&l.length>0)for(var h=0,c=l.length;h<c;h++)if(l[h](a,s,u))return;o(a,s,u)}else u(0,null,null,"not found handler")}),i=e.ro.postHandlers;return i&&i.length>0?o.resolve().then(function(){for(var e=n,t=0,r=i.length;t<r;t++)e=i[t](e);return e}):n};return r.setHeader=function(e){return header=t({},e),r},r.addHeader=function(e){return header=t({},this.getHeader(),e),r},r.getHeader=function(){return r.header||e.ro.header||{}},r.getUrl=function(t){return e.ro.analysis(t)},r}},{key:"handler",get:function(){return this.createHandler()}}]),e}(),j=[h("requestOptions"),h("requesters"),h("configure"),h("getRequestItem")],w=j[0],O=j[1],P=j[2],q=j[3],F=function(){function e(t,n){r(this,e),this[P]=new p,this.setBaseUrl(t).addRequests(n)}return n(e,[{key:q,value:function(e){return this[O]||(this[O]={}),e in this[w]&&!(e in this[O])&&(this[O][e]=new H(this[w][e])),this[O]&&this[O][e]}}]),e}();Object.defineProperty(F.prototype,"addRequests",{configurable:!1,enumerable:!1,get:function(){return function(e){var t=this;if(e){this[w]||(this[w]={});var r=function(r){t[w][r]=new C(t[P],e[r]),l(t,r,{get:function(){var e=this[q](r);return e&&e.handler}})};for(var n in e)r(n)}return this}.bind(this)}});for(var U=["setBaseUrl","setHeader","addHeader","bindHandler","bindPreHandler","bindPostHandler","bindDictate","setSerializater","setErrorHandler","setAction","setDictate","setEscape","use"],A=U.length,x=function(e){var t=U[e];l(F,t,{configurable:!1,enumerable:!1,get:function(){return function(){return b[t].apply(b,arguments),this}.bind(this)}}),l(F.prototype,t,{configurable:!1,enumerable:!1,get:function(){return function(){var e;return(e=this[P])[t].apply(e,arguments),this}.bind(this)}})},z=0;z<A;z++)x(z);return F});