/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.EasyHttp=e()}(this,function(){"use strict";function t(t,e){return void 0==t?t===e:t.constructor===e||t instanceof e}var e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t};function r(t){if(t){let e;return t.split(":").forEach(t=>{t&&(e||(e=new Array),e.push(t))}),e}}function s(e){return t(e,Object)&&(e=JSON.stringify(e)),e}class i{setBaseUrl(t){return this.baseUrl=t||"",this}setHeaders(t){return this.h=e({},t),this}addHeaders(t){return this.h=this.h?e({},this.h,t):e({},t),this}setHandler(t){return this.hd=t,this}bindDictate(t,e){return t&&e&&(this.dm||(this.dm={}),this.dm[t.toLowerCase()]=e),this}setAction(t){return this.defA=t,this}setDictate(t){return this.defD=r(t),this}setSerializater(t){return this.sz=t,this}setErrorHandler(t){return this.eh=t,this}setEscape(t){return this.esc=t,this}use(e){return e&&e.install&&t(e.install,Function)&&e.install(this),this}}const n=new i;class a{constructor(t){this.outConf=t}get headers(){return this.outConf.h||{}}set escape(t){t&&(this.esc=t)}get escape(){return void 0!=this.esc?this.esc:void 0!=this.outConf.esc?this.outConf.esc:void 0!=n.esc&&n.esc}set dictate(t){this.defD=r(t)}get dictate(){return this.defD||this.outConf.defD||n.defD}set action(t){this.defA=t}get action(){return(this.defA||this.outConf.defA||n.defA||"get").toLowerCase()}get baseUrl(){return this.outConf.baseUrl||n.baseUrl}get serializater(){return this.outConf.sz||n.sz||s}get errorHandler(){return this.outConf.eh||n.eh}get handler(){return this.outConf.hd||n.hd}dictateMap(t){return this.outConf.dm&&this.outConf.dm[t]||n.dm&&n.dm[t]}}const o=/(?:\[([^[{]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,h="*:hold-bl:*",l="*:hold-br:*",c="*:hold-ml:*",u="*:hold-mr:*";class d extends a{constructor(e,r){super(e),r&&(t(r,Object)?((r.action||r.a)&&(this.action=r.action||r.a),(r.urlFormat||r.u)&&(this._urlFormat=r.urlFormat||r.u),(r.escape||r.esc)&&(this.escape=r.escape||r.esc),this.dictate=r.dictate||r.d):this._urlFormat=r)}get urlFormat(){return this._urlFormatHold||this._urlFormat}reSetUrlFormat(){var t;this.escape?this._urlFormatHold||(this._urlFormatHold=(t=this._urlFormat)?t.replace("\\{",h).replace("\\}",l).replace("\\[",c).replace("\\]",u):t):this._urlFormatHold&&delete this._urlFormatHold,this.makeMatchsMap()}makeMatchsMap(){if(!this.matchsMap||this._matchsUrl!==this.urlFormat){let t;for(this.matchsMap={},this._matchsUrl=this.urlFormat;null!=(t=o.exec(this._matchsUrl));){let e={match:t[0],prefix:t[1],key:t[2],suffix:t[4]};if(t[3]){t[3].split(":").forEach(t=>{t&&(e.dictate||(e.dictate=new Array),e.dictate.push(t))})}this.matchsMap[e.key]=e}}return this.matchsMap}recoverUrl(t){return this._urlFormatHold?(e=t)?e.replace(h,"{").replace(l,"}").replace(c,"[").replace(u,"]"):e:t;var e}analysis(t){let e;this.reSetUrlFormat(),t||(t={});let r=this.urlFormat,s=this.matchsMap;if(s)for(let e in s)if(!(e in t)){let t=s[e];r=r.replace(t.match,"")}for(let i in t){let n=s[i],a=t[i]||"",o=this.serializater;a=o(a);let h=n&&n.dictate||this.dictate;h&&h.forEach(t=>{let e=this.dictateMap(t);e&&(a=e(a))}),n?(a=a?(n.prefix||"")+a+(n.suffix||""):"",r=r.replace(n.match,a)):(a||(a=""),e||(e=""),e+=(e?"&":"")+i+"="+a)}r=r?this.recoverUrl(r):"";let i=this.baseUrl+r;return e&&(i+=(i.indexOf("?")<0?"?":"&")+e),i}}var f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t};class p{constructor(t){this.ro=t}get handler(){return this.createHandler()}createHandler(){let t=this,e=function(r){return new Promise(function(e,s){let i=this.getUrl(r&&r.params),n=t.ro.action;let a=t.ro.handler;a?a({resolve:function(t){return console.log(`EasyHttp-Url: [${n}]${i}`),console.log("EasyHttp-Respons: ",t&&void 0!=t.data&&t.data||t,"\n"),e(t)},reject:function(e){return r&&r.handleCatch?s(e):t.ro.errorHandler?t.ro.errorHandler(e):(console.error(`EasyHttp-Url: [${n}]${i}`),void console.error("EasyHttp-ResponseError: ",e&&e.toString()||e,"\n"))},url:i,action:n,datas:r.datas,handler:this.getHeaders()}):(console.warn(`EasyHttp-Url: [${n}]${i}`),console.warn("EasyHttp-Warn:","not found handler","\n"))}.bind(e))};return e.setHeaders=function(t){return headers=t,e},e.addHeaders=function(t){return headers=f({},this.getHeaders(),t),e},e.getHeaders=function(){return e.headers||t.ro.headers||{}},e.getUrl=function(e){return t.ro.analysis(e)},e}}const[m,g,b,y]=[Symbol("requestOptions"),Symbol("requesters"),Symbol("configure"),Symbol("getRequestItem")];class H{constructor(t,e){this[b]=new i,this.setBaseUrl(t).addRequests(e)}[y](t){return this[g]||(this[g]={}),t in this[m]&&!(t in this[g])&&(this[g][t]=new p(this[m][t])),this[g]&&this[g][t]}}Object.defineProperty(H.prototype,"addRequests",{configurable:!1,enumerable:!1,get:function(){return function(t){if(t){this[m]||(this[m]={});for(let e in t)this[m][e]=new d(this[b],t[e]),Object.defineProperty(this,e,{get:function(){let t=this[y](e);return t&&t.handler}})}return this}.bind(this)}});const U=["setBaseUrl","setHeaders","addHeaders","setHandler","bindDictate","setSerializater","setErrorHandler","setAction","setDictate","setEscape","use"],v=U.length;for(let t=0;t<v;t++){let e=U[t];Object.defineProperty(H,e,{configurable:!1,enumerable:!1,get:function(){return function(){return n[e](...arguments),this}.bind(this)}}),Object.defineProperty(H.prototype,e,{configurable:!1,enumerable:!1,get:function(){return function(){return this[b][e](...arguments),this}.bind(this)}})}return H});