/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("babel-runtime/core-js/object/get-prototype-of"),require("babel-runtime/helpers/possibleConstructorReturn"),require("babel-runtime/helpers/inherits"),require("babel-runtime/core-js/json/stringify"),require("babel-runtime/helpers/toConsumableArray"),require("babel-runtime/core-js/promise"),require("babel-runtime/core-js/object/define-property"),require("babel-runtime/core-js/symbol")):"function"==typeof define&&define.amd?define(["babel-runtime/helpers/classCallCheck","babel-runtime/helpers/createClass","babel-runtime/core-js/object/get-prototype-of","babel-runtime/helpers/possibleConstructorReturn","babel-runtime/helpers/inherits","babel-runtime/core-js/json/stringify","babel-runtime/helpers/toConsumableArray","babel-runtime/core-js/promise","babel-runtime/core-js/object/define-property","babel-runtime/core-js/symbol"],e):t.EasyHttp=e(t._classCallCheck,t._createClass,t._Object$getPrototypeOf,t._possibleConstructorReturn,t._inherits,t._JSON$stringify,t._toConsumableArray,t._Promise,t._Object$defineProperty,t._Symbol)}(this,function(i,a,s,o,e,r,u,l,c,t){"use strict";function h(t,e){return null==t?t===e:t.constructor===e||t instanceof e}function n(t){if(t){var e=void 0;return t.split(":").forEach(function(t){t&&(e||(e=new Array),e.push(t))}),e}}i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a,s=s&&s.hasOwnProperty("default")?s.default:s,o=o&&o.hasOwnProperty("default")?o.default:o,e=e&&e.hasOwnProperty("default")?e.default:e,r=r&&r.hasOwnProperty("default")?r.default:r,u=u&&u.hasOwnProperty("default")?u.default:u,l=l&&l.hasOwnProperty("default")?l.default:l,c=c&&c.hasOwnProperty("default")?c.default:c,t=t&&t.hasOwnProperty("default")?t.default:t;var f=function(){function t(){i(this,t)}return a(t,[{key:"setBaseUrl",value:function(t){return this.baseUrl=t||"",this}},{key:"bindAction",value:function(t,e){return t&&e&&(this.am||(this.am={}),this.am[t.toLowerCase()]=e),this}},{key:"bindDictate",value:function(t,e){return t&&e&&(this.dm||(this.dm={}),this.dm[t.toLowerCase()]=e),this}},{key:"setAction",value:function(t){return this.defA=t,this}},{key:"setDictate",value:function(t){return this.defD=n(t),this}},{key:"setSerializater",value:function(t){return this.sz=t,this}},{key:"setErrorHandler",value:function(t){return this.eh=t,this}},{key:"setEscape",value:function(t){return this.esc=t,this}},{key:"use",value:function(t){return t&&t.install&&h(t.install,Function)&&t.install(this),this}}]),t}(),d=new f,p=function(){function e(t){i(this,e),this.outConf=t}return a(e,[{key:"actionMap",value:function(t){return this.outConf.am&&this.outConf.am[t]||d.am&&d.am[t]}},{key:"dictateMap",value:function(t){return this.outConf.dm&&this.outConf.dm[t]||d.dm&&d.dm[t]}},{key:"escape",set:function(t){t&&(this.esc=t)},get:function(){return null!=this.esc?this.esc:null!=this.outConf.esc?this.outConf.esc:null!=d.esc&&d.esc}},{key:"dictate",set:function(t){this.defD=n(t)},get:function(){return this.defD||this.outConf.defD||d.defD}},{key:"action",set:function(t){this.defA=t},get:function(){return(this.defA||this.outConf.defA||d.defA||"get").toLowerCase()}},{key:"baseUrl",get:function(){return this.outConf.baseUrl||d.baseUrl}},{key:"serializater",get:function(){return this.outConf.sz||d.sz}},{key:"errorHandler",get:function(){return this.outConf.eh||d.eh}}]),e}(),m=/(?:\[([^[{]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi,b="*:hold-bl:*",y="*:hold-br:*",v="*:hold-ml:*",g="*:hold-mr:*";function _(t){return h(t,Object)&&(t=r(t)),t}var k=function(t){function n(t,e){i(this,n);var r=o(this,(n.__proto__||s(n)).call(this,t));return e&&(h(e,Object)?((e.action||e.a)&&(r.action=e.action||e.a),(e.urlFormat||e.u)&&(r._urlFormat=e.urlFormat||e.u),(e.escape||e.esc)&&(r.escape=e.escape||e.esc),r.dictate=e.dictate||e.d):r._urlFormat=e),r}return e(n,p),a(n,[{key:"reSetUrlFormat",value:function(){var t;this.escape?this._urlFormatHold||(this._urlFormatHold=(t=this._urlFormat)?t.replace("\\{",b).replace("\\}",y).replace("\\[",v).replace("\\]",g):t):this._urlFormatHold&&delete this._urlFormatHold,this.makeMatchsMap()}},{key:"makeMatchsMap",value:function(){var t=this;if(!this.matchsMap||this._matchsUrl!==this.urlFormat){this.matchsMap={},this._matchsUrl=this.urlFormat;for(var r=void 0,e=function(){var e={match:r[0],prefix:r[1],key:r[2],suffix:r[4]};r[3]&&r[3].split(":").forEach(function(t){t&&(e.dictate||(e.dictate=new Array),e.dictate.push(t))});t.matchsMap[e.key]=e};null!=(r=m.exec(this._matchsUrl));)e()}return this.matchsMap}},{key:"recoverUrl",value:function(t){return this._urlFormatHold?(e=t)?e.replace(b,"{").replace(y,"}").replace(v,"[").replace(g,"]"):e:t;var e}},{key:"analysis",value:function(a){var s=this;this.reSetUrlFormat(),a||(a={});var o=void 0,u=this.urlFormat,l=this.matchsMap;if(l)for(var t in l)if(!(t in a)){var e=l[t];u=u.replace(e.match,"")}var r=function(t){var e=l[t],r=a[t]||"",n=s.serializater||_;r=n(r);var i=e&&e.dictate||s.dictate;i&&i.forEach(function(t){var e=s.dictateMap(t);e&&(r=e(r))}),e?(r=r?(e.prefix||"")+r+(e.suffix||""):"",u=u.replace(e.match,r)):(r||(r=""),o||(o=""),o+=(o?"&":"")+t+"="+r)};for(var n in a)r(n);u=u?this.recoverUrl(u):"";var i=this.baseUrl+u;return o&&(i+=(i.indexOf("?")<0?"?":"&")+o),i}},{key:"urlFormat",get:function(){return this._urlFormatHold||this._urlFormat}}]),n}(),C={i:function(t){for(var e,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).log.apply(e,[t+":"].concat(u(n)))},d:function(t){for(var e,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).debug.apply(e,[t+":"].concat(u(n)))},w:function(t){for(var e,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).warn.apply(e,[t+":"].concat(u(n)))},e:function(t){for(var e,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).error.apply(e,[t+":"].concat(u(n)))}};function w(t){C.e("EasyHttp-ResponseError",t&&t.toString()||t)}var j=function(t){function n(t,e){i(this,n);var r=o(this,(n.__proto__||s(n)).call(this,t));return r.ro=e,r}return e(n,p),a(n,[{key:"createHandler",value:function(){var u=this,t=function t(o){return new l(function(e,r){var t=this.getUrl(o&&o.params),n=u.ro.action;C.i("EasyHttp-Url",n+":"+t);var i=u.actionMap(n);if(i)if(h(i,Function))i(function(t){return C.i("\nEasyHttp-Response",t&&null!=t.data&&t.data||t),e(t)},function(t){return o&&o.handleCatch?r(t):(u.errorHandler||w)(t)},t);else{var a=n?"the action:'"+n+"' is not Function":"default action is not Function";C.w("EasyHttp",a)}else{var s=n?"not found the action:'"+n+"'":"not found default action";C.w("EasyHttp",s)}}.bind(t))};return t.getUrl=function(t){return u.ro.analysis(t)},t}},{key:"handler",get:function(){return this.createHandler()}}]),n}(),F=[t("requestOptions"),t("requesters"),t("configure"),t("getRequestItem")],O=F[0],A=F[1],H=F[2],U=F[3],q=function(){function r(t,e){i(this,r),this[H]=new f,this.setBaseUrl(t).addRequests(e)}return a(r,[{key:U,value:function(t){return this[A]||(this[A]={}),t in this[O]&&!(t in this[A])&&(this[A][t]=new j(this[H],this[O][t])),this[A]&&this[A][t]}}]),r}();Object.defineProperty(q.prototype,"addRequests",{configurable:!1,enumerable:!1,get:function(){return function(t){var r=this;if(t){this[O]||(this[O]={});var e=function(e){r[O][e]=new k(r[H],t[e]),c(r,e,{get:function(){var t=this[U](e);return t&&t.handler}})};for(var n in t)e(n)}return this}.bind(this)}});for(var E=["setBaseUrl","bindAction","bindDictate","setSerializater","setErrorHandler","setAction","setDictate","setEscape","use"],P=E.length,M=function(t){var e=E[t];c(q,e,{configurable:!1,enumerable:!1,get:function(){return function(){return d[e].apply(d,arguments),this}.bind(this)}}),c(q.prototype,e,{configurable:!1,enumerable:!1,get:function(){return function(){var t;return(t=this[H])[e].apply(t,arguments),this}.bind(this)}})},z=0;z<P;z++)M(z);return q});