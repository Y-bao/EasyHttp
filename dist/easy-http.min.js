/*!
* easy-http.js v1.0.0
* (c) 2018-2018 PengYuan-Jiang
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.EasyHttp=e()}(this,function(){"use strict";var i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),c=/(?:\[([^{[]*))?{\s*([a-z_][a-z0-9_]*)\s*((?::[a-z_][a-z0-9_]*)*)\s*}(?:([^}\]]*)\])?/gi;return function(){function u(t,r){var n=this;if(i(this,u),this.baseUrl=t,r){this.src={};var e=function(e){n.src[e]=n.createSrc(r[e]),Object.defineProperty(n,e,{get:function(){var t=this.getRequestItem(e);return t&&t.handler}})};for(var a in r)e(a)}}return t(u,[{key:"createSrc",value:function(t){var e,r,n=void 0;t&&(e=t,r=Object,null==e?e===r:e.constructor===r||e instanceof r)?(n={action:t.action,urlFormat:t.urlFormat},t.dictate&&t.dictate.split(":").forEach(function(t){t&&(n.dictate||(n.dictate=new Array),n.dictate.push(t))})):n={urlFormat:t};return n}},{key:"getRequestItem",value:function(t){return this.requests||(this.requests={}),t in this.src&&!(t in this.requests)&&(this.requests[t]=this.createRequestItem(this.src[t])),this.requests&&this.requests[t]}},{key:"createRequestItem",value:function(t){for(var r={},n=void 0,e=function(){a=n[2];var e={match:n[0],prefix:n[1],suffix:n[4]};n[3]&&n[3].split(":").forEach(function(t){t&&(e.dictate||(e.dictate=new Array),e.dictate.push(t))});r.matchsMap||(r.matchsMap={}),r.matchsMap[a]=e};null!=(n=c.exec(t.urlFormat));){var a;e()}var i=this;return Object.defineProperty(r,"handler",{get:function(){return i.createHandler(t,r)}}),r}},{key:"createHandler",value:function(i,r){var n=this,t=function t(a){return new Promise(function(t,e){var r=this.getUrl(a),n=u.actionMap&&(u.actionMap[i.action||""]||u.actionMap[""]);n?n(t,e,r):e(i.action?"not found the action:'"+i.action+"'":"not found default action")}.bind(t))},e=function(t){var e=n.analysis(i,r.matchsMap,t);return n.baseUrl+e};Object.defineProperty(t,"getUrl",{get:function(){return e}});var a=function(t){return this.header=t,this}.bind(t);return Object.defineProperty(t,"header",{get:function(){return a}}),t}},{key:"analysis",value:function(a,i,c){var o=a.urlFormat;if(i){c||(c={});var t=function(t){var e=i[t],r=c[t],n=e.dictate||a.dictate;n?n.forEach(function(t){var e=u.dictateMap&&u.dictateMap[t];e&&(r=e(r))}):u.processors&&u.processors.forEach(function(t){r=t(r)}),r=r?(e.prefix||"")+r+(e.suffix||""):"",o=o.replace(e.match,r)};for(var e in i)t(e)}return o||(o=""),o}}],[{key:"bindAction",value:function(t,e){e&&(u.actionMap||(u.actionMap={}),u.actionMap[t||""]=e)}},{key:"bindDictate",value:function(t,e){t&&e&&(u.dictateMap||(u.dictateMap={}),u.dictateMap[t]=e)}},{key:"addDefProcessor",value:function(){for(var t,e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];r&&(u.processors||(u.processors=new Array),(t=u.processors).push.apply(t,r))}}]),u}()});